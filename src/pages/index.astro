---
import Layout from "../layouts/Layout.astro";
import PocketBase from "pocketbase";
import CardItem from "../components/CardItem.astro";
import fond1 from '../assets/fond1.webp';


const pbUrl = import.meta.env.PUBLIC_PB_URL;
if (!pbUrl) {
  throw new Error("PUBLIC_PB_URL manquant. Ajoute PUBLIC_PB_URL dans .env et redémarre le serveur.");
}



const pb = new PocketBase(pbUrl);


const res = await pb.collection("card_accueil").getList(1, 200, {
  sort: "created", 
});


const items = res.items.map((r) => ({
  record: r,
  imgUrl: r.img ? pb.files.getUrl(r, r.img) : ""
}));


const sortedItems = [...items].sort(
  (a, b) => new Date(a.record.created).getTime() - new Date(b.record.created).getTime()
);


const categoriesUI = [
  {
    name: "Photographie",
    traits: ["Inventivité", "Polyvalence", "Créativité", "Mise en valeurs", "Création technique & artistique"],
  },
  {
    name: "Audiovisuel",
    traits: ["Captation d'évènement", "Régis de plateau TV et Streaming", "Création technique & artistique"],
  },
  {
    name: "Évènementiel",
    traits: ["Aide", "Sociabilité", "Logistique", "Enquêtes", "Services", "Accueil", "Gestion des lieux"],
  },
  {
    name: "Communication",
    traits: ["Post", "Visuels", "Flyers, affiches", "Vidéo promotionnelles"],
  },
  {
    name: "Design graphique",
    traits: ["Maquette UX/UI", "Posters", "Visuels", "Cover"],
  },
  {
    name: "Autres",
    traits: ["Dessin", "Peinture", "Musique (MAO)", "Illustration"],
  },
];


const categoriesFromPB = [...new Set(
  items.map(({ record }) => record.categorie).filter((v) => !!v)
)].sort((a, b) => a.localeCompare(b));


const urlCat = Astro.url.searchParams.get("cat");
const filteredItems = urlCat && urlCat !== "ALL"
  ? sortedItems.filter(({ record }) => record.categorie === urlCat)
  : sortedItems;
---


<body style={`background-image: url('${fond1.src}');`}>
<Layout>


  <!-- Titre -->
  <div class="flex flex-col items-center justify-center min-h-screen bg-transparent relative">
    <h1
      class="text-center text-[32px] sm:text-[48px] md:text-[60px] px-4 sm:px-8 md:px-12"
      style="font-family: 'Climate Crisis', sans-serif;
             -webkit-text-stroke-width: 30px;
             -webkit-text-stroke-color: transparent;
             -webkit-text-fill-color: white;
             color: white;
             background: linear-gradient(33deg, #0000FF, #FF00C8, #7B00FF);
             -webkit-background-clip: text;
             background-clip: text;
             display: inline-block;"
    >
      Ethan<br />HENNEQUIN DE MEYER
    </h1>


    <!-- Flèche vers Qq proj -->
    <button
      onclick="document.getElementById('qq-proj-section').scrollIntoView({ behavior: 'smooth' })"
      class="absolute bottom-4 sm:bottom-8 left-1/2 -translate-x-1/2 cursor-pointer hover:opacity-80 hover:scale-110 transition-all bg-black/10 backdrop-blur-sm rounded-full p-2 mb-3"
      aria-label="Descendre vers les projets"
    >
      <svg width="40" height="40" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg" class="sm:w-12 sm:h-12">
        <path d="M24 8V40M24 40L8 24M24 40L40 24" stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    </button>
  </div>



  <!-- Defilement -->
  <div class="bg-transparent overflow-hidden h-8 sm:h-12 w-full relative -translate-y-8 sm:-translate-y-12">
    <style>
      @keyframes scroll { 0% { transform: translateX(0%);} 100% { transform: translateX(-100%);} }
      .scrolling-text { display:inline-block; white-space:nowrap; animation:scroll 20s linear infinite; font-family:"Cal Sans",sans-serif; font-size:clamp(14px, 4vw, 24px); color:black; padding-right:50px; }
      .scrolling-container { display:flex; height:100%; align-items:center; width:fit-content; }
    </style>
    <div class="scrolling-container">
      <div class="scrolling-text">Practice any art, music, singing, dancing… no matter how well or badly, not to get money and fame, but to experience becoming, to find out what's inside you, to make your soul grow... - Sir Ian McKellen</div>
      <div class="scrolling-text">Practice any art, music, singing, dancing… no matter how well or badly, not to get money and fame, but to experience becoming, to find out what's inside you, to make your soul grow... - Sir Ian McKellen</div>
    </div>
  </div>


  <!-- Catégorie -->
    <div class="hidden md:block min-h-screen p-4 sm:p-6 md:p-8">
    <div class="max-w-6xl mx-auto">
      <div class="ml-2 sm:ml-4 mb-8">
        <h1
          style="font-family: 'Climate Crisis'; -webkit-text-stroke: 2px #FF00C8; paint-order: stroke fill;"
          class="text-[24px] sm:text-[28px] md:text-[32px] text-black"
        >
          Mes domaines
        </h1>
      </div>



      <div class="space-y-12 md:space-y-20">
        {
          categoriesUI.map((category, index) => (
            <div key={index} class="group flex flex-col md:flex-row md:items-start gap-4 md:gap-12 cursor-pointer md:h-[45px]">
              <div class="w-full md:w-64 md:flex-shrink-0 opacity-0 md:group-hover:opacity-100 transition-opacity duration-300">
                <ul class="space-y-1 md:space-y-2">
                  {(category.traits ?? []).map((trait, traitIndex) => (
                    <li key={traitIndex} class="flex items-start gap-2 md:gap-3">
                      <span class="text-black text-lg md:text-2xl mt-0 flex-shrink-0">•</span>
                      <span style="font-family: 'Cal Sans'" class="text-black text-[14px] sm:text-[18px] md:text-[18px] leading-tight">{trait}</span>
                    </li>
                  ))}
                </ul>
              </div>



              <div class="flex-grow group/title">
                <h2
                  style="font-family: 'Climate Crisis'; -webkit-text-stroke: 2px #7B00FF; paint-order: stroke fill; color: black;"
                  class="text-[28px] sm:text-[36px] md:text-[48px] transition-all duration-300 hover:bg-transparent"
                  onmouseover="this.style.color='#7B00FF'; this.style.WebkitTextStroke='1px black';"
                  onmouseout="this.style.color='black'; this.style.WebkitTextStroke='2px #7B00FF';"
                >
                  {category.name}
                </h2>
              </div>



              {index === 0 && (
                <div class="w-full md:w-80 md:flex-shrink-0">
                  <p style="font-family: 'Cal Sans'" class="text-[14px] sm:text-[18px] md:text-[18px] text-black leading-tight">
                    Je suis polyvalent, c'est l'essence même de mon univers créatif.
                    <br /><br />
                    Œuvrer sur de différents supports avec des idées variés et toujours originale.
                  </p>
                </div>
              )}
            </div>
          ))
        }
      </div>
    </div>
  </div>



  <style>
    .domain-title { -webkit-text-stroke: 2px #CAFB23; paint-order: stroke fill; transition: color .25s, -webkit-text-stroke-color .25s; }
    .domain-title:hover { color:#CAFB23; -webkit-text-stroke:1px black; }
  </style>



  <!-- Qq proj -->
  <div class="flex justify-center items-center mt-6 sm:mt-10 py-8 sm:py-16" id="qq-proj-section">
    <div
      class="relative mx-4 sm:mx-5 w-[calc(100%-32px)] sm:w-[calc(100%-40px)] px-4 sm:px-8 md:px-16 py-4 sm:py-8 sm:pt-5 sm:pb-5 hover:shadow-3xl transition-shadow"
      style="border-radius: clamp(40px, 10vw, 71px); background: radial-gradient(ellipse 100% 60% at center, #E5E5E7 0%, #7B00FF 100%); font-family: 'Climate Crisis', sans-serif;"
    >
      <h2 class="text-2xl sm:text-3xl md:text-4xl font-black text-black text-center">Quelques projets...</h2>
    </div>
  </div>


  <!-- section projets -->
  <section class="mx-auto max-w-6xl px-4 mb-5">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-x-8 md:gap-y-10 justify-items-center">
    {filteredItems.slice(0, 6).map(({ record, imgUrl }, i) => (
      <div class="w-full sm:w-[400px] md:w-[468px] group">
        <!-- toute la carte est incluse dans la zone de hover -->
        <div
          class="will-change-transform transition-transform transition-[filter]
                 duration-150 ease-[cubic-bezier(.2,.8,.2,1)]
                 group-hover:duration-250 group-hover:ease-[cubic-bezier(.16,1,.3,1)]
                 group-active:scale-[0.995] group-hover:scale-[1.06] group-hover:brightness-110"
        >
          <CardItem record={record} imgUrl={imgUrl} align={i % 2 === 0 ? "left" : "right"} />
        </div>
      </div>
    ))}
  </div>
</section>



</Layout>
</body>
